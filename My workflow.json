{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        0,
        0
      ],
      "id": "",
      "name": "Telegram Trigger",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "",
              "name": "nahhas",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        208,
        0
      ],
      "id": "",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "url": "=",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        416,
        0
      ],
      "id": "",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "=You are a product image analysis expert.\n\nYour goal is to analyze any image provided and describe every visual detail about the product in it. Focus on identifying and explaining the following:\n\n- Product name and brand (from logo or visible text)\n- Logo design and placement\n- Colors and packaging details\n- Any visible text, slogans, or numbers on the product\n- Shape, material, and texture\n- Background elements (if any)\n- Lighting and scene context\n\nYour output should only include the description, nothing else.",
        "imageUrls": "",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2.1,
      "position": [
        624,
        0
      ],
      "id": "",
      "name": "Analyze image",
      "credentials": {
        "openAiApi": {
          "id": "",
          "name": "n8n free OpenAI API credits"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Use the provided image as the exact and unmodified background reference.\n\nDo NOT change the environment, background, lighting, shadows, colors, depth of field, or camera position in any way.\n\nAdd ONE realistic adult human naturally holding the SAME camera shown in the reference image.\nThe person must appear physically present in the scene, as if they were always there.\n\nThe camera must be held in a natural, correct grip with realistic hand anatomy and finger placement.\nEnsure correct proportions, realistic skin texture, and natural posture.\n\nMatch the original scene’s perspective, scale, lens characteristics, and lighting direction perfectly.\nThe person must blend seamlessly into the scene with accurate shadows and reflections.\n\nPhotorealistic result. No stylization. No cinematic exaggeration.\nNo background alteration of any kind.\n\nReference image description:\n{{ $json['0'].content[0].text }}\n",
        "options": {
          "systemMessage": "Role: You create image prompts.\n\nMain objective: Insert the product (or the item from the image) into realistic, everyday situations. These resemble content captured by regular people or influencers on their phones.\n\nCharacters should always be described as realistic and lifelike.\n\nIf the user gives vague instructions, use this structure:\nplace (product) into a scene with the (character).\n\nUGC focus: When the user wants authentic, user-generated content, assume casual everyday scenes unless told otherwise.\n\nIf the video takes place in a car, the perspective should be from in front of the character, with the headrest of the seat visible behind their head.\n\nStyle guidelines: All results should feel natural and unstaged, never polished or professional. Specifically:\n\nRelatable real-world settings\n\nProduct text must remain untouched and accurate (logos, claims, slogans). Do not invent details or numbers.\n\niPhone snapshot look (basic, amateur quality)\n\nCasual poses and unposed expressions\n\nSunlight on the character, skin detail\n\nRULES:\n\nAlways use single quotes ('') never use double quotes (\"\")\n\nYour only output should be the image prompt itself. No other text.\n\nNo need to generate dialogue or video instructions. Only still image prompts.\n\nIf the user specifies a different style or setting, follow their direction.\n\nNever use hyphens or dashes.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        832,
        0
      ],
      "id": "",
      "name": "AI Agent"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        992,
        208
      ],
      "id": "",
      "name": "Think"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization ",
              "value": ""
            },
            {
              "name": "Content-Type ",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"openai/gpt-5-image-mini\",\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": \"={{'Generate an image using this prompt:\\\\n\\\\n' + $json.output}}\",\n\"image_size\": \"1:1\"\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1184,
        0
      ],
      "id": "",
      "name": "HTTP Request1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1392,
        0
      ],
      "id": "",
      "name": "Wait",
      "webhookId": ""
    },
    {
      "parameters": {
        "language": "pythonNative",
        "pythonCode": "data_url = _items[0][\"json\"][\"choices\"][0][\"message\"][\"images\"][0][\"image_url\"][\"url\"]\nbase64_data = data_url.split(\",\")[1]\n\n_items[0][\"binary\"] = {\n  \"image\": {\n    \"data\": base64_data,\n    \"mimeType\": \"image/png\",\n    \"fileName\": \"flux.png\"\n  }\n}\n\nreturn _items\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1600,
        0
      ],
      "id": "",
      "name": "Code in Python"
    },
    {
      "parameters": {
        "model": "openai/gpt-5-image-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        704,
        208
      ],
      "id": "",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.cloudinary.com/v1_1/ddjazoedq/image/upload",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "image"
            },
            {
              "name": "upload_preset",
              "value": "n8n_upload"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1840,
        0
      ],
      "id": "",
      "name": "HTTP Request2",
      "credentials": {
        "httpBasicAuth": {
          "id": "",
          "name": "Unnamed credential"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=create video prompt.\n\nuser instructions:{{ $('Telegram Trigger').item.json.message.caption }}\n\nDescription of reference image: {{ $('AI Agent').item.json.output }}",
        "options": {
          "systemMessage": "=You are an AI agent that generates UGC (User-Generated Content) video prompts.\n\nYou MUST follow the structure, wording rules, and style exactly as described below.\nYou are NOT allowed to paraphrase, rewrite, or invent dialogue.\nYou may ONLY modify the description and camera sections as allowed.\n\n────────────────────────\nLOCKED DIALOGUE (DO NOT CHANGE):\nDialogue: 'شايفين هاي الكاميرا؟ هاي الكاميرا احسن كاميرا ممكن تصور فيها... اعداداتها مناسبة لكل تصويراتك، بصراحة بنصحك فيها'\n────────────────────────\n\nSTRUCTURE RULES (MANDATORY):\n\nYour output must follow this exact order:\n\n1) Dialogue (use the exact text above, verbatim)\n2) Description (natural flowing paragraph)\n3) Camera (filming style)\n\nDo NOT add or remove sections.\n\n────────────────────────\nDESCRIPTION RULES (ALLOWED TO CHANGE):\n- Describe ONLY what is visible in the image\n- Character appearance and vibe\n- Action: holding the camera naturally (not actively filming)\n- Real, everyday environment\n- No marketing language\n- No exaggeration\n- No new concepts beyond the image\n\n────────────────────────\nCAMERA RULES (ALLOWED TO CHANGE):\n- UGC-style filming\n- Sony camera video look and color science\n- Natural video lighting suitable for video\n- Soft daylight, balanced highlights and shadows\n- Slight handheld feel\n- Shallow depth of field\n- Realistic skin tones\n\n────────────────────────\nSTYLE GUIDELINES:\n- Natural, candid, unpolished\n- Feels like a real person, not an ad\n- No staged poses\n- No cinematic overproduction\n\n────────────────────────\nFORMATTING RULES:\n- Use single quotes for dialogue only\n- Never use double quotes\n- Never mention JSON or scenes\n- Output ONE continuous ready-to-use video prompt\n- Do not add explanations or notes\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        2048,
        0
      ],
      "id": "",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.kie.ai/api/v1/veo/generate",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": ""
            },
            {
              "name": "=Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({\n  prompt: $json.output,\n  imageUrls: $('HTTP Request2').item.json.url,\n  model: \"veo3_fast\",\n  aspectRatio: \"9:16\",\n  duration: 8\n}) }}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2400,
        0
      ],
      "id": "",
      "name": "HTTP Request3"
    },
    {
      "parameters": {
        "url": "https://api.kie.ai/api/v1/veo/record-info",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "taskId",
              "value": "={{ $json.data.taskId }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": ""
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2848,
        0
      ],
      "id": "",
      "name": "HTTP Request4"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2608,
        0
      ],
      "id": "",
      "name": "Wait1",
      "webhookId": "ca946c5b-233a-4bb6-b86e-4fffa51b2f84"
    },
    {
      "parameters": {
        "operation": "sendVideo",
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "file": "={{ $json.data.response.resultUrls[0] }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3056,
        0
      ],
      "id": "",
      "name": "Send a video",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": "Telegram account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Analyze image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze image": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Code in Python",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in Python": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request4": {
      "main": [
        [
          {
            "node": "Send a video",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "567d91dd-aa06-4610-8eb5-59289f2cdacd",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "d8d64ccc6eb2e3cdb9352c3155aea53c49863c51de0529a6edaffcb0be31f025"
  },
  "id": "aApJvaoNz6RawM6Kl-LDD",
  "tags": []
}
